<!doctype html>
<meta charset="utf-8">
<body>

    <title>Star Wars DB lookup:</title>
    <h2>People</h2>
    <ul data-simply-list="people">
    <template>
        <li>
            <span data-simply-field="name">person</span>
            ,
            <span data-simply-field="height">height</span>
            tall
        </li>
    </template>
    </ul>

    <script src="https://cdn.simplyedit.io/1/simply-edit.js" data-simply-storage="none"></script>
    <script src="https://cdn.jsdelivr.net/gh/SimplyEdit/simplyview@2.0.2/dist/simply.everything.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@muze-nl/jsontag@0.9.0/dist/browser.js" type="text/javascript"></script>

    <script type="module" >

    import * as metro from "https://cdn.jsdelivr.net/npm/@muze-nl/metro@0.2.2/src/metro.mjs"

    let url = "http://localhost:3000/query/";
    let queryPeople = 'from(data.people).select({ name : _, height: _})';

    const client = metro.client(url);

    var hnpwa = simply.app({
        routes: {
            '/:*': function(params) {
                client.post({body: queryPeople })
                .then(response => response.text())
                .then(text => {
                    let peopleX = JSONTag.parse(text);
                    let peopleString = JSON.stringify(peopleX); //parsing the json twice due to a firefox bug
                    let displayPeople = JSON.parse(peopleString);
                    hnpwa.view.people = displayPeople;
                });

            }
        },
        view: {
            people: [],
        }
    });

    </script>


</body>